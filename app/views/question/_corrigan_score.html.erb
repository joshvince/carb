<div class="w-full max-w-2xl mx-auto">
  <%
    carb_data = local_assigns[:totals]
    max_score = carb_data.first[:corrigan_score]
  %>

  <div class="mx-6">
    <details>
      <summary class="px-4 cursor-pointer font-semibold text-stone-500">
        Corrigan Score Explained
      </summary>
      <div class="px-4 pt-3 text-stone-700 ">
        <p class="mb-3">
          The Corrigan Score is the more traditional way of answering The Carb Question, which draws results from a cumulative - if arcane - positional scoring system.
          Contenders that rank first score more points than those who rank second, and so on.
        </p>
        <p class="mb-3">
          Historically, The Corrigan score was the only official system until The ISOCRA's controversial "Winton Decree".
          After years of lobbying and often politically incited violence from pressure groups who argued that the Corrigan score
          merely rewarded mediocrity, The Weighted Havoc Ratio was introduced in 2018.
        </p>
        <p>
          In a post-Winton world, fans of The Carb Question are free to pick whichever score suits their own agenda,
          a quirk that has led inexplicably to both more and less politically-motivated violence than before the Decree.
        </p>
      </div>
    </details>
  </div>

  <div class="flex flex-col gap-y-6 p-6">
    <% carb_data.each_with_index do |carb, index| %>
      <% score_percentage = calculate_score_percentage(carb[:corrigan_score], max_score) %>
      <div class="relative bg-gradient-to-br from-yellow-200/30 to-yellow-100/30 rounded-md shadow-md shadow-stone-200 py-6 px-4 lg:px-6">
        <div class="absolute top-1 left-2 text-sm text-amber-600 font-bold"><%= ranking_label(index + 1) %> Place</div>
        <div class="flex items-end justify-between mb-4">
          <div class="flex items-center gap-x-2 lg:gap-x-4">
            <div class="text-2xl lg:text-4xl"><%= carb[:emoji] %></div>
            <div>
              <h3 class="text-2xl lg:text-4xl text-amber-800 font-black"><%= carb[:name] %></h3>
            </div>
          </div>
          <div class=" flex flex-col items-end justify-start">
            <div class="text-xs lg:text-sm text-amber-600 font-bold">Corrigan Score</div>
            <div class="text-xl lg:text-3xl text-amber-900 font-black"><%= carb[:corrigan_score] %> pts</div>
          </div>
        </div>

        <div class="mb-4">
          <div class="w-full bg-amber-200 rounded-full h-3">
            <div class="bg-gradient-to-r from-amber-500 to-amber-600 h-3 rounded-full transition-all duration-500"
                  style="width: <%= score_percentage %>%"></div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
